---
title: "Bayesian Framework"
author: "Jaeseok Hwang"
format:
  html:
    toc: true
    toc-depth: 3
    code-fold: false
execute:
  echo: false
  warning: false
  message: false
bibliography: value_refs.bib
---

# Bayesian Framework {-}

A fundamental challenge in learning nitrogen–yield response functions from on-farm precision experiments (OFPE) is that each field typically provides only one or two years of observations, a limitation widely noted in agronomic experimentation and on-farm trial design @bullock2019ofpe; @mieno2022learning. Although these trials generate thousands of spatially rich subplot measurements within a season, the information comes from a single realization of weather. Let $N$ denote the nitrogen rate (lb/ac), and let $Y(N)$ denote the stochastic yield generated by agronomic and climatic processes. The long-run distribution of interest is

$$
F^\star(y \mid N) = \Pr(Y(N) \le y),
$$

which governs the uncertainty a farmer must confront when making nitrogen decisions @antle1983stochastic; @just1990studies. Profit at rate $N$ is

$$
\pi(N) = p_y\,Y(N) - p_n\,N,
$$

and a risk-neutral farmer chooses

$$
N^\star = \arg\max_N \left\{ p_y\,\mathbb{E}[Y(N)] - p_n N \right\}.
$$

Accurate decision making therefore depends on forming a predictive distribution that reflects the long-run variability of weather and soil interactions rather than the particular conditions observed in a single year of experimentation. An OFPE mean in year $t$ can be interpreted as

$$
\bar{Y}(N) \approx Y(N)\,\big|\,W_t,
$$

where $W_t$ is the realized weather of that season. Even two years of data provide only two realizations of $W_t$, which is insufficient to approximate the full distribution $F^\star(y\mid N)$ or to reveal the curvature of the underlying nitrogen response function. Consequently, methods that rely solely on OFPE data—such as direct estimation or machine-learning prediction—tend to overfit the realized weather state and fail to generalize across years or fields @mendonca2023nitrogenresponse; @mieno2022learning.

The Bayesian framework resolves this limitation by integrating OFPE data with two additional sources of information. The APSIM crop model produces multi-decade simulations that encode agronomic relationships among nitrogen, soil, and weather @holzworth2014apsim. For each nitrogen rate, APSIM yields a distribution characterized by prior moments

$$
\mu_{1,0}(N), \qquad \mu_{2,0}(N), \qquad \mu_{3,0}(N),
$$

which summarize the mean, variance, and third central moment implied by long-run simulated climate sequences. These moments define a prior density

$$
f_0(y \mid N),
$$

which is informative about long-run behavior but not tailored to any particular field. County-level yield histories add information about regional technological trends and recent climatic anomalies, allowing the prior to reflect the broader environment in which each OFPE trial is conducted @naderi2020yieldtrends; @usdaNASS.

Against this prior background, OFPE data provide likelihood information about the field-specific mean yield. For nitrogen rate $N_k$ with $n_k$ subplot measurements, the sample mean satisfies

$$
\bar{Y}_k \mid \mu_1(N_k)
\sim
\mathcal{N}\!\left(\mu_1(N_k),\,\frac{\sigma^2(N_k)}{n_k}\right),
$$

following standard sampling theory for subplot-scale agronomic experiments @casella2002statistical; @gelman2013bayesian. Because each subplot is small, the sample mean offers a precise measurement of the seasonal average, but only for the weather state actually realized in that year. To reconcile long-run prior information with year-specific evidence, the unknown field-level mean $\mu_1(N)$ is assigned a prior distribution

$$
\mu_1(N) \sim \mathcal{N}\!\left(m_0(N),\,v_0(N)\right),
$$

where $m_0(N)=\mu_{1,0}(N)$ and $v_0(N)$ reflects uncertainty in how well APSIM represents the field. Conditioning on the OFPE mean yields the posterior distribution

$$
\mu_1(N) \mid \bar{Y}(N)
\sim
\mathcal{N}\!\left(m_1(N),\,v_1(N)\right),
$$

where

$$
v_1(N)
=
\left[
\frac{1}{v_0(N)} + \frac{n(N)}{\sigma^2(N)}
\right]^{-1},
$$

and

$$
m_1(N)
=
v_1(N)\left[
\frac{m_0(N)}{v_0(N)}
+
\frac{n(N)\bar{Y}(N)}{\sigma^2(N)}
\right].
$$

The structure of these expressions illustrates how Bayesian learning balances long-run agronomic information with short-run field evidence, consistent with general Bayesian estimation principles in hierarchical modeling @gelman2013bayesian. When the OFPE experiment contains many subplots, the observed mean provides strong information about the yield level for that specific season, but the prior prevents the estimate from drifting too far from the distribution implied by multi-decade simulations. Conversely, when only one or two seasons of OFPE data are available, the posterior remains anchored near the prior because limited weather realizations cannot reveal the underlying response curve. Over time, as additional OFPE years accumulate, the posterior shifts progressively toward the field’s true long-run distribution.

To support nitrogen decisions, the posterior distribution of the mean must be translated into a posterior predictive distribution for yields. Conceptually, this is obtained from

$$
f_{\text{post}}(y \mid N)
=
\int f(y \mid \mu_1(N)) \,
p(\mu_1(N) \mid \text{data}) \,
d\mu_1(N),
$$

a mixture distribution combining uncertainty about the long-run mean with within-year stochastic variation. In practice, this predictive distribution is represented using a maximum-entropy density that matches the posterior mean, posterior variance, and third central moment, following classical moment-based maximum-entropy methods @jaynes1957information1; @jaynes1957information2.

The Bayesian structure therefore establishes a long-term decision-support mechanism. Each year of OFPE data contributes incrementally to the understanding of field-level nitrogen response, while APSIM simulations and regional histories provide the broader context needed to interpret those observations. The result is a coherent learning system: even with limited OFPE data today, the framework ensures that all available knowledge is combined efficiently, and as OFPE seasons accumulate, the posterior predictive distribution becomes increasingly field-specific. In this way, Bayesian updating converts sparse short-run experiments into a cumulative learning process capable of guiding nitrogen decisions under uncertainty.
