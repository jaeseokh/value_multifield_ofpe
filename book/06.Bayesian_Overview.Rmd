---
title: "Overview(Bayesian) "
author: "Jaeseok Hwang"
format:
  html:
    toc: true
    code-fold: false
execute:
  echo: false
  warning: false
  message: false
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(
message = FALSE,
warning = FALSE,
fig.align = "center",
fig.width = 7,
fig.height = 5,
dpi = 300
)

library(here)
library(dplyr)
library(ggplot2)
library(patchwork)

book_figure_bayes2_dir <- here("book","Results","Figures","stage2_bayes")

p_combined <- readRDS(
file.path(book_figure_bayes2_dir, "apsim_ofpe_panel.rds")
)

```


## Background {-}

On-farm precision experiments (OFPE) generate dense yield data across a wide range of nitrogen (N) rates on individual commercial fields. At first glance, this appears ideal for directly estimating a field’s yield–N relationship and using machine-learning algorithms to choose an economically optimal N rate. Yet the earlier ensemble-model analysis revealed a deeper structural issue: the observed yield is shaped by a highly complex interaction between nitrogen, soils, landscape variation, drainage, and intra-annual weather. A single OFPE year captures only one realization of that joint system, and even two years rarely span meaningful weather diversity. Machine-learning models fit these data well in-sample but fail to generalize across years and fields because the signal is thin and overwhelmed by field-specific noise.

Therefore, the question is not whether OFPE can deliver perfect forecasts. It cannot. The more relevant question is how OFPE can be used together with broader and more stable information sources—APSIM simulations, long-run county yield histories, and regional production trends—to help farmers form more coherent and more defensible beliefs about their field’s yield–N curve as years accumulate.

The shift in perspective is fundamental. Instead of treating one or two OFPE years as a full estimator of the response function, OFPE should be viewed as incremental evidence that complements a larger information structure already available to the farmer.



## Information Structure: APSIM, OFPE, and Regional Yield Trends {-}

The map below introduces this structure. OFPE fields (black points) lie within APSIM simulation cells (colored polygons), each representing a 30-year distribution of yields over agronomic and weather variability.

```{r fig1, echo=TRUE, cache=TRUE, fig.width=12, fig.height=7, fig.cap="Figure 1. Information structure of APSIM and OFPE data at Illinois "}

p_combined

```

This spatial structure matters because APSIM provides a stable representation of long-run biophysical behavior, while OFPE provides short-run, field-specific realizations. The combination of these two sources is the foundation of Bayesian updating.

To illustrate their divergence, it is helpful to also look at the panel of OFPE–APSIM curve comparisons for 2023, shown below. These figures highlight the empirical challenge: OFPE responses differ across fields and weather states, and APSIM’s long-run mean often lies below observed yields at low N rates, partly because recent genetic gains and modern management have increased yield potential faster than calibrated crop models typically reflect.

```{r fig2, echo=TRUE, cache=TRUE, fig.width=12, fig.height=7, fig.cap="Figure 2. OFPE, APSIM and regional average yield comparison in 2023 "}

knitr::include_graphics(file.path(book_figure_bayes2_dir, "apsim_ofpe_curves_2023.pdf"))

```

The pattern shown here—APSIM underestimating low-N yields in some years, OFPE curves differing sharply even within the same region, and substantial within-N yield variation—underscores the need for a framework that neither over-reacts to one noisy trial nor blindly relies on long-run simulation outputs.

## Why a Bayesian Perspective Is Needed Now {-}

From a decision-making standpoint, a farmer must choose N before observing the growing season, based on uncertain beliefs about the yield–N function. Three realities make Bayesian updating appropriate.

First, OFPE alone cannot be treated as a full estimator of the response curve. With only one or two years of data and large within-N variance, relying exclusively on OFPE produces overfitting: the yield–N curve inferred from a single season is too tightly tied to that year’s weather and idiosyncratic field conditions.

Second, APSIM alone cannot be treated as the truth either. While APSIM encodes agronomic knowledge and long-run climate variability, it can systematically misrepresent the level and curvature of field-level responses. This leads to under-fitting: the recommendations based solely on APSIM may ignore persistent field-specific deviation from the regional or simulated pattern.

Third, county-level historical yield trends offer information about regional production trajectories, but not about the curvature of yield–N relationships. They tell us how yield potential has shifted over time due to genetics or management, and thus provide context for calibrating and interpreting APSIM priors. For example, when regional yields consistently exceed APSIM mid-range predictions, this discrepancy informs how the prior should be interpreted and why OFPE deviations are not surprising.

A Bayesian perspective provides a disciplined way to combine these imperfect sources. However, with only one or two OFPE years available today, the posterior should not be interpreted as a finalized “answer.” Instead, it should be viewed as a framework for long-run learning, designed so that sequential OFPE seasons—accumulated over time or across producers—can gradually refine the field-specific beliefs.

## Using OFPE in a Long-Term Decision Framework {-}

The role of OFPE in this study is therefore not to produce an immediate, sharply defined posterior curve, but to serve as the basis for a cumulative learning process. Even two replicated trials on the same field can already reveal important economic structure: whether the field consistently sits above or below its regional trend; whether the yield–N shape is stable or highly sensitive to weather; and whether the APSIM prior consistently over- or under-predicts the observed range.

Over time, OFPE provides a slow but informative sequence of signals. APSIM provides the broad envelope of plausible responses. County yield histories provide temporal context and calibration. Together they constitute a hierarchy of evidence that supports a farmer’s evolving beliefs.

The objective of the Bayesian chapters in this book is to establish this structure—not to assert that the current posterior is sufficiently precise, but to define the mechanism through which accumulating OFPE data will eventually yield more reliable and more profitable nitrogen decisions.